#!/usr/bin/env node

const { testBuild } = require('./testBuild');
const { testDevServer } = require('./testDevServer');
const logger = require('../logger');

let devServerProcess;

function handleFailure() {
  if (devServerProcess) {
    devServerProcess.kill();
  }
}

process.on('SIGINT', () => {
  handleFailure();
});

process.on('uncaughtException', e => {
  console.error(e);
  handleFailure();
});

try {
  testBuild(logger);
  testDevServer(logger, devServerProcess);
} catch (e) {
  console.error(e.message);
  logger.error('Tests failed ðŸ˜­');
  handleFailure();
  process.exit(1);
}
